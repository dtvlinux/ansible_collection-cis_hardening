---
- name: "Import tasks for role"
  when: >
    ansible_facts["distribution"]               == 'Ubuntu' and
    ansible_facts["distribution_major_version"] == '24'
  tags: cis_hardening_ubuntu
  block:

    # Can take along time to run on shutdown and even hangs interfering with reboot tasks
    - name: Stop unattended-upgrades service
      ansible.builtin.service:
        name: unattended-upgrades
        state: stopped
        enabled: false

    - name: Configure filesystem kernel modules
      ansible.builtin.import_tasks: configure_filesystem_kernel_modules/main.yml
      tags:
        - cis_hardening_ubuntu_1_1
        - cis_hardening_ubuntu_1_1_1

    - name: Configure filesystem partitions
      ansible.builtin.import_tasks: configure_filesystem_partitions/main.yml
      tags:
        - cis_hardening_ubuntu_1_1
        - cis_hardening_ubuntu_1_1_2
